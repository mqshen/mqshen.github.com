---
layout: post
title: "Java虚拟机结构"
description: "如果只是要去“正确地”实现一台 Java 虚拟机,其实并不如大多数人所想的那样高深和困难 ——只需要正确读取 Class 文件之中每一条字节码指令,并且能正确执行这些指令所蕴含的操作 即可。所有在虚拟机规范之中没有明确描述的实现细节,都不应成为虚拟机设计者发挥创造性的牵 绊,设计者可以完全自主决定所有规范中不曾描述的虚拟机内部细节."
category: ""
tags: [JVM]
---
{% include JB/setup %}

###Class 文件格式

编译后被 Java 虚拟机所执行的代码使用了一种平台中立(不依赖于特定硬件及操作系统的) 的二进制格式来表示,
并且经常(但并非绝对)以文件的形式存储,因此这种格式被称为 Class 文件格式。Class 文件格式中精确地定义了类与接口的表示形式,
包括在平台相关的目标文件格式中一些细节上的惯例1,例如字节序(Byte Ordering)等。

###数据类型

与 Java 程序语言中的数据类型相似,Java 虚拟机可以操作的数据类型可分为两类:原始类 型(Primitive Types,也经常翻译为原生类型或者基本类型)和引用类型(Reference Types)。 与之对应,也存在有原始值(Primitive Values)和引用值(Reference Values)两种类 型的数值可用于变量赋值、参数传递、方法返回和运算操作。

###原始类型与值
Java 虚拟机所支持的原始数据类型包括了数值类型(Numeric Types)、布尔类型(Boolean Type §2.3.4)和 returnAddress 类型(§2.3.3)三类。其中数值类型又分为整型类型 (Integral Types,§2.3.1)和浮点类型(Floating-Point Types,§2.3.2)两种.

###引用类型与值
Java虚拟机中有三种引用类型:类类型(Class Types)、数组类型(Array Types)和 接口类型(Interface Types)。这些引用类型的值分别由类实例、数组实例和实现了某个接口 的类实例或数组实例动态创建。

###运行时数据区

####PC寄存器
Java 虚拟机可以支持多条线程同时执行,每一条 Java 虚拟机线程都有自己的PC(Program Counter)寄存器。在任意时刻,一条Java虚拟机线程 只会执行一个方法的代码,这个正在被线程执行的方法称为该线程的当前方法(Current Method,§2.6)。如果这个方法不是 native 的,那 PC 寄存器就保存 Java 虚拟机正在执行的 字节码指令的地址,如果该方法是 native 的,那 PC 寄存器的值是 undefined。PC 寄存器的容 量至少应当能保存一个 returnAddress 类型的数据或者一个与平台相关的本地指针的值。

####Java虚拟机栈
每一条Java虚拟机线程都有自己私有的Java虚拟机栈,这个栈与线程同时创建,用于存储栈帧.

####Java堆
在Java虚拟机中,堆(Heap)是可供各条线程共享的运行时内存区域,也是供所有类实例和数组对象分配内存的区域。


